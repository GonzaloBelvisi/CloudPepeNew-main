<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@ViewData["Title"] - Pepe</title>

  <!-- Iconify para SVGs -->
  <script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>

  <!-- Tailwind + darkMode -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: { 'slate-750': '#1e293b' }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
  <link rel="stylesheet" href="~/SitradWebInterface.styles.css" asp-append-version="true" />

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
</head>

<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200">

  <!-- Dashboard Header -->
    <!-- Dashboard Header -->
  <header class="shadow-md border-b border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800">
    <div class="px-4 py-3 flex items-center justify-between">
      
      <!-- Izquierda: icono + título + timestamp -->
      <div class="flex items-center gap-3">
        <span class="iconify text-2xl text-blue-600 dark:text-blue-300" data-icon="lucide:thermometer" data-inline="false"></span>
        <div>
          <p class="font-bold text-slate-800 dark:text-white">@ViewData["Title"]</p>
          <p class="text-xs text-slate-500 dark:text-slate-400">
            Actualizado: <span id="last-updated">Ahora</span>
          </p>
        </div>
      </div>

      <!-- Derecha: usuario + enlace + botón de refresco + logout -->
      <div class="flex items-center space-x-4">
        @if (ViewData["UserRole"] != null)
        {
          <div class="flex items-center gap-2 px-3 py-1 bg-slate-700 rounded-lg">
            <span class="iconify text-lg text-white" data-icon="lucide:user" data-inline="false"></span>
            <span class="text-sm text-white">
              @ViewData["UserRole"]
            </span>
          </div>
        }
        <a href="https://editarsensorescoronelraiz.sa.ngrok.io/Sitrad/Pin"
           target="_blank"
           class="px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition">
          Coronel Raíz
        </a>
        <button
          id="refresh-btn"
          onclick="doRefresh()"
          class="p-2 rounded-full bg-slate-700 hover:bg-slate-600 transition"
          aria-label="Refrescar todo">
          <span class="iconify text-xl text-white" data-icon="lucide:refresh-cw" data-inline="false"></span>
        </button>
        <form asp-action="Logout" asp-controller="Account" method="post" class="inline">
          <button
            type="submit"
            class="p-2 rounded-full bg-red-600 hover:bg-red-700 transition"
            aria-label="Cerrar sesión"
            title="Cerrar sesión">
            <span class="iconify text-xl text-white" data-icon="lucide:log-out" data-inline="false"></span>
          </button>
        </form>
      </div>
    </div>
  </header>

  <div class="min-h-screen max-w-screen-lg mx-auto px-4">
    <main role="main" class="pb-3">
      @RenderBody()
    </main>
  </div>

  <!-- jQuery (NECESARIO para usar $ en tu JS) -->
  <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJ+Y2vFmJ9ggcf2gN/6I4Q7PeU5yihDjvk9jk="
    crossorigin="anonymous">
  </script>

  <!-- Lógica de refresco y timestamp -->
  <script>
    function updateTimestamp() {
      const now = new Date();
      document.getElementById('last-updated').textContent =
        now.toLocaleTimeString('es-ES', { hour12: false });
    }

    function doRefresh() {
      updateTimestamp();
      if (typeof updateDashboard === 'function') {
        updateDashboard();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateTimestamp();
      setInterval(doRefresh, 5000);
    });
  </script>

  <!-- Tu script principal -->
  <script src="~/js/site.js" asp-append-version="true"></script>

  @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
